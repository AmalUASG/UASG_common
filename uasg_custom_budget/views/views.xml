<odoo>
  <data>
    <!-- explicit list view definition -->


 <record id="reject_budget_line" model="ir.ui.view">
            <field name="name">Reject wizard</field>
            <field name="model">reject.budget.line.wizard</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <group>
                            <field name="name"/>
                            <field name="budget_line_id" readonly="1" />                
                        </group>
                    
                    </sheet>
                    <footer>
                        <button name="action_reject" string="Reject" type="object" class="oe_highlight" />
                       
                        <button string="Cancel" class="btn-secondary" special="cancel" />
                    </footer>
                </form>
            </field>
        </record>

<!-- actions opening views on models -->


    
    <record id="reject_budget_line_wizard_action" model="ir.actions.act_window">
            <field name="name">Reject Budget Demand</field>
            <field name="res_model">reject.budget.line.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="view_id" ref="uasg_custom_budget.reject_budget_line"/>
</record>

    <record model="ir.ui.view" id="budget_list">
      <field name="name">Budgets list</field>
      <field name="model">budget</field>
      <field name="arch" type="xml">
        <tree>
          <field name="name" />
          <field name="company_id"/>
          <field name="department" string="Department" />
          <field name="state" widget="badge" decoration-success="state=='approved'" decoration-warning="state=='pending'" />

      </tree>
  </field>
</record>



    <record model="ir.ui.view" id="category_list">
      <field name="name">Category list</field>
      <field name="model">category</field>
      <field name="arch" type="xml">
        <tree editable="bottom">
          <field name="name" />
      </tree>
  </field>
</record>



<record model="ir.ui.view" id="budget_items_list">
      <field name="name">Budgets Item</field>
      <field name="model">budget.line</field>
      <field name="arch" type="xml">
        <tree>
          <field name="name" />
          <field name="create_uid"/>
          <field name="department" string="Department"/>
          <field name="company_id"/>
          <field name="budget_line_state" widget="badge" decoration-success="budget_line_state=='submit'" decoration-warning="budget_line_state=='draft'" />
          <field name="company_currency_id" invisible="1"/>
          <field name="cost_by_company_currency" string="cost" widget="monetary" options="{'currency_field': 'company_currency_id'}" sum="Total Cost"/>


      </tree>
  </field>
</record>

<record model="ir.ui.view" id="budget_form">
  <field name="name">Budgets form</field>
  <field name="model">budget</field>
  <field name="arch" type="xml">
    <form>

        <header>
         <button name="action_submit" string="Submit" type="object" class="oe_highlight" attrs="{'invisible': [('state', 'in', ['pending','approved'])]}" groups="uasg_custom_budget.group_budget_dept_manager"/>

         <button name="action_approve" string="Approve" type="object" class="oe_highlight" attrs="{'invisible': [('state', 'in', ['draft','approved'])]}" groups="uasg_custom_budget.group_budget_approval"/>

         <button name="action_reject" string="Reject" type="object" class="btn-danger" attrs="{'invisible': [('state', 'in', ['draft','approved'])]}" groups="uasg_custom_budget.group_budget_approval"/>

         <field name="state" widget="statusbar"/>
     </header>

     <sheet>
      <div class="oe_title">
        <label for="name" string="Subject"/>
        <h1>
            <field class="text-break" name="name" placeholder="e.g. IT Demand plan for 2023" required="1" attrs="{'readonly':[('state','in',['pending','approved'])]}"/>
        </h1>
        <div>
            <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" placeholder="Tags" style="width: 100%" attrs="{'readonly':[('state','in',['pending','approved'])]}"/>
        </div>
    </div>
    <group>
        <group>
         <label for="duration_from" string="Planned Duration"/>
         <div name="dates" class="o_row" >
            <field name="duration_from" widget="date" attrs="{'readonly':[('state','in',['pending','approved'])]}" />
            <i class="fa fa-long-arrow-right mx-2 oe_edit_only" aria-label="Arrow icon" title="Arrow"/>
            <i class="fa fa-long-arrow-right mx-2 oe_read_only" aria-label="Arrow icon" title="Arrow" attrs="{'invisible': [('duration_from', '=', False), ('duration_to', '=', False)]}"/>
            <field name="duration_to" widget="date" attrs="{'readonly':[('state','in',['pending','approved'])]}" />
        </div>
        <field name="currency_id" invisible="1"/>
        <field name="total_budget_cost" widget="monetary" options="{'currency_field': 'currency_id'}"/>
    </group>
    <group attrs="{'invisible':[('id' , '=' ,False)]}">
      <field name="company_id" />
      <field name="department"/>
      <field name="department_manager" />
  </group>
</group>

<notebook >
    <page string="Budget Demands" name="demands" >
      <field name="budget_line"  widget="section_and_note_one2many"  mode="tree,kanban" attrs="{'readonly':[('state','in',['pending','approved'])]}">
        <tree string="Demands" editable="bottom" domain="[('budget_line_state' , '=' , 'submit')]">
            <field name="name" string="Subject"/>
            <field name="budget_line_state" invisible="1"/>
            <field name="description" widget="html" />
            <field name="create_uid" string="Owner"/>
            <field name="duration_from" string="From"/>
            <field name="duration_to" string="To"/>
            <field name="currency_id" invisible="1"/>

            <field name="cost_by_company_currency" string="Cost in AED" widget="monetary" options="{'currency_field': 'company_currency_id'}" sum="Total Cost"/>
             <button name="%(reject_budget_line_wizard_action)d" string="Reject Demand" type="action" groups="uasg_custom_budget.group_budget_dept_manager"
            context="{'default_budget_line_id': id}"/>
        </tree>
    </field>
</page>
</notebook>
</sheet>
<div class="oe_chatter">
    <field name="message_follower_ids"/>
    <field name="message_ids"/>
</div>
</form>
</field>
</record>
<record model="ir.ui.view" id="budget_line_form">
  <field name="name">Budgets Item</field>
  <field name="model">budget.line</field>
  <field name="arch" type="xml">
    <form>

        <header>

             <button name="action_submit" string="Submit" type="object" class="oe_highlight" attrs="{'invisible': ['|',('budget_line_state', '=', 'submit'),('state' ,'in', ['approved','pending'])]}" groups="uasg_custom_budget.group_budget_user"/>

         <field name="budget_line_state" widget="statusbar"/>

        </header>

        <sheet>

          <div class="oe_title">
            <label for="name" string="Subject"/>
            <h1>
                <field class="text-break" name="name" attrs="{'readonly' : ['|',('budget_line_state' ,'=', 'submit'),('state' ,'in', ['approved','pending'])]}"/>
            </h1>

        </div>

        <group>
          <group>

            <field name="state" invisible="1"/>

          <field name="budget_id" attrs="{'readonly' : ['|',('budget_line_state' ,'=', 'submit'),('state' ,'in', ['approved','pending'])]}" domain="[('state','not in', ['approved','pending'])]" options="{'no_create': True, 'no_create_edit':True}" />

          <field name="category_id" options="{'no_create': True, 'no_create_edit':True}"/>



        <label for="duration_from" string="Planned Duration"/>
         <div name="dates" class="o_row"  >
            <field name="duration_from" placeholder="From" widget="date" attrs="{'readonly':['|',('budget_line_state' ,'=', 'submit'),('state','in',['pending','approved'])]}" />
            <i class="fa fa-long-arrow-right mx-2 oe_edit_only" aria-label="Arrow icon" title="Arrow"/>
            <i class="fa fa-long-arrow-right mx-2 oe_read_only" aria-label="Arrow icon" title="Arrow" attrs="{'invisible': [('duration_from', '=', False), ('duration_to', '=', False)]}"/>
            <field name="duration_to" placeholder="To" widget="date" attrs="{'readonly':['|',('budget_line_state' ,'=', 'submit'),('state','in',['pending','approved'])]}" />
        </div>

        
<field name="reject_reason" readonly="1" attrs="{'invisible':['|',('reject_reason','=',False),('budget_line_state','=','submit')]}"/>
     
      </group>
<group>
      <label for="cost" string="Cost"/>
      <div name="cost" class="o_row" >
          <field name="currency_id" attrs="{'readonly' : ['|',('budget_line_state' ,'=', 'submit'),('state' ,'in', ['approved','pending'])]}"/>
          <field name="cost" widget="monetary" options="{'currency_field': 'currency_id'}" attrs="{'readonly' : ['|',('budget_line_state' ,'=', 'submit'),('state' ,'in', ['approved','pending'])]}" />
        </div>
          <field name="company_currency_id" invisible="1"/>


          <field name="cost_by_company_currency"  string="Cost in AED" widget="monetary" readonly="1"  options="{'currency_field': 'company_currency_id'}" attrs="{'readonly' : ['|',('budget_line_state' ,'=', 'submit'),('state' ,'in', ['approved','pending'])]}" />



        <field name="create_uid"/>

        <field name="business_company_id" options="{'no_create': True, 'no_create_edit':True}" attrs="{'readonly' : ['|',('budget_line_state' ,'=', 'submit'),('state' ,'in', ['approved','pending'])]}" />
              
        <field name="business_department" options="{'no_create': True, 'no_create_edit':True}" aattrs="{'readonly' : ['|',('budget_line_state' ,'=', 'submit'),('state' ,'in', ['approved','pending'])]}" />

      </group>
    </group>

      <notebook>

        <page name="description" string = "Description">

            <field name = "description" widget="html" attrs="{'readonly' : ['|',('budget_line_state' ,'=', 'submit'),('state' ,'in', ['approved','pending'])]}"/>

        </page>

    </notebook>

</sheet>
<div class="oe_chatter">
    <field name="message_follower_ids"/>
    <field name="message_ids"/>
</div>
</form>
</field>
</record>





<record model="ir.actions.act_window" id="budget_action_window">
  <field name="name">Demand Budgets</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">budget</field>
  <field name="view_mode">tree,form</field>
</record>


<record model="ir.actions.act_window" id="department_action_window">
  <field name="name">Departments</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">department</field>
  <field name="view_mode">tree,form</field>
</record>

<record model="ir.actions.act_window" id="categories_action_window">
  <field name="name">Categories</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">category</field>
  <field name="view_mode">tree</field>
</record>

<record model="ir.actions.act_window" id="budget_items_action_window">
  <field name="name">Budget Items</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">budget.line</field>
  <field name="view_mode">tree,form</field>

</record>


<record model="ir.actions.act_window" id="templates_action_window">
  <field name="name">Email Templates</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">mail.template</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('model_id','in',['budget','budget.line'])]</field>
  <field name="context">{'create':0,'delete':0}</field>


</record>



<!-- Top menu item -->

<menuitem
    id="budget_main_menu"
    name="Budget"
    groups=""
    sequence="1"
    web_icon="uasg_custom_budget,static/description/icon.png"
    />

    <!-- menu categories -->


    <menuitem name="Plans" id="demand_budgets" sequence = "1" parent="budget_main_menu" action="budget_action_window" />

    <menuitem name="Budget Items" id="items" sequence = "2" parent="budget_main_menu" action="budget_items_action_window"/>

    <menuitem name="Configuration" id="configuration" sequence = "3" parent="budget_main_menu" groups="base.group_system"/>

    <menuitem name="Departments" id="departments" parent="configuration" action="department_action_window"/>

    <menuitem name="Categories" id="categories" parent="configuration" action="categories_action_window"/>

    <menuitem name="Email Templates" id="email_templates" parent="configuration" action="templates_action_window"/>



</data>
</odoo>
